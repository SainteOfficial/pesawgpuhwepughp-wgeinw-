-- ğŸ’ Skript zum Anzeigen der Items im benutzerdefinierten Backpack
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RuntimeLib = require(ReplicatedStorage:WaitForChild("rbxts_include"):WaitForChild("RuntimeLib"))

-- Notwendige Module importieren
local LocalUser = RuntimeLib.import(script, ReplicatedStorage, "TS", "user", "local", "local-user").LocalUser
local ItemsWithId = RuntimeLib.import(script, ReplicatedStorage, "TS", "item", "items").ItemsWithId
local ItemCategory = RuntimeLib.import(script, ReplicatedStorage, "TS", "item", "item-category").ItemCategory
local Rarity = RuntimeLib.import(script, ReplicatedStorage, "TS", "rarity").Rarity

-- Kategorie-Emojis
local CATEGORY_EMOJIS = {
    POTION = "ğŸ§ª",
    TRAIT = "ğŸ§¬",
    TITLE = "ğŸ‘‘",
    EQUIPMENT = "âš”ï¸",
    ARTIFACT = "ğŸ”®",
    INSTANT_ROLL = "ğŸ²",
    CARD_BACK = "ğŸƒ",
    RAID = "ğŸ°",
    MISC = "ğŸ“¦"
}

-- Seltenheits-Emojis
local RARITY_EMOJIS = {
    COMMON = "âšª",
    UNCOMMON = "ğŸŸ¢",
    RARE = "ğŸ”µ",
    EPIC = "ğŸŸ£",
    LEGENDARY = "ğŸŸ ",
    MYTHIC = "ğŸ”´"
}

-- Gibt das passende Emoji fÃ¼r eine Kategorie zurÃ¼ck
local function getCategoryEmoji(categoryName)
    return CATEGORY_EMOJIS[categoryName] or "â“"
end

-- Gibt das passende Emoji fÃ¼r eine Seltenheit zurÃ¼ck
local function getRarityEmoji(rarityName)
    return RARITY_EMOJIS[rarityName] or "â“"
end

-- Erzeugt eine Trennlinie
local function divider(length)
    return string.rep("â”", length or 50)
end

-- Formatiert eine Ãœberschrift
local function header(text)
    return "\n" .. divider() .. "\nâœ¨ " .. text .. " âœ¨\n" .. divider()
end

-- Funktion zum Anzeigen der Backpack-Items
local function printBackpackItems()
    print(header("BACKPACK INHALT"))
    
    -- Backpack-Items aus der Atom-Map abrufen
    local backpackItems = LocalUser.atomMap.player().backpack.items
    
    -- PrÃ¼fen, ob Items vorhanden sind
    local itemCount = 0
    for _ in pairs(backpackItems) do
        itemCount = itemCount + 1
    end
    
    if itemCount == 0 then
        print("ğŸ“­ Keine Items im Backpack gefunden.")
        return
    end
    
    print("ğŸ” Gefunden: " .. itemCount .. " Items\n")
    
    -- Items nach Kategorie sortieren
    local categorizedItems = {}
    
    for itemId, itemData in pairs(backpackItems) do
        local itemInfo = ItemsWithId[itemId]
        if itemInfo then
            local categoryName = (itemInfo.category and itemInfo.category.name) or "UNKNOWN"
            
            if not categorizedItems[categoryName] then
                categorizedItems[categoryName] = {}
            end
            
            table.insert(categorizedItems[categoryName], {
                id = itemId,
                info = itemInfo,
                data = itemData
            })
        end
    end
    
    -- Items nach Kategorie ausgeben
    for categoryName, items in pairs(categorizedItems) do
        local emoji = getCategoryEmoji(categoryName)
        print(emoji .. " " .. categoryName .. " (" .. #items .. ")")
        
        -- Items innerhalb der Kategorie anzeigen
        for _, item in ipairs(items) do
            local rarityName = (item.info.rarity and item.info.rarity.name) or "UNKNOWN"
            local rarityEmoji = getRarityEmoji(rarityName)
            local equipped = (item.data.equipped and "âœ…") or "âŒ"
            
            print(string.format(
                "  %s %s (Ã—%d) %s",
                rarityEmoji,
                item.info.name,
                item.data.quantity or 0,
                equipped
            ))
        end
        
        print("")
    end
end

-- Funktion zum Anzeigen aller ausgerÃ¼steten Items
local function printEquippedItems()
    print(header("AUSGERÃœSTETE ITEMS"))
    
    local equippedTitle = LocalUser.backpack:getEquippedTitle()
    local equippedEquipment = LocalUser.backpack:getEquippedEquipment()
    local equippedArtifact = LocalUser.backpack:getEquippedArtifact()
    
    local equipCount = 0
    
    if equippedTitle then
        print("ğŸ‘‘ Titel: " .. equippedTitle.item.name)
        equipCount = equipCount + 1
    end
    
    if equippedEquipment then
        print("âš”ï¸ AusrÃ¼stung: " .. equippedEquipment.item.name)
        equipCount = equipCount + 1
    end
    
    if equippedArtifact then
        print("ğŸ”® Artefakt: " .. equippedArtifact.item.name)
        equipCount = equipCount + 1
    end
    
    if equipCount == 0 then
        print("ğŸ” Keine Items ausgerÃ¼stet")
    end
end

-- Funktion zum Anzeigen ausfÃ¼hrlicher Item-Details
local function printDetailedItem(itemId)
    local backpackItems = LocalUser.atomMap.player().backpack.items
    local itemData = backpackItems[itemId]
    
    if not itemData then
        print("âŒ Item mit ID " .. itemId .. " nicht gefunden!")
        return
    end
    
    local itemInfo = ItemsWithId[itemId]
    if not itemInfo then
        print("â“ Keine Informationen fÃ¼r Item mit ID " .. itemId .. " verfÃ¼gbar!")
        return
    end
    
    print(header("ITEM DETAILS"))
    
    local categoryName = (itemInfo.category and itemInfo.category.name) or "UNKNOWN"
    local rarityName = (itemInfo.rarity and itemInfo.rarity.name) or "UNKNOWN"
    
    print("ğŸ“‹ Name: " .. itemInfo.name)
    print("ğŸ”‘ ID: " .. itemId)
    print(getCategoryEmoji(categoryName) .. " Kategorie: " .. categoryName)
    print(getRarityEmoji(rarityName) .. " Seltenheit: " .. rarityName)
    print("ğŸ”¢ Anzahl: " .. (itemData.quantity or 0))
    print("ğŸ½ Status: " .. (itemData.equipped and "AusgerÃ¼stet âœ…" or "Nicht ausgerÃ¼stet âŒ"))
    
    if itemInfo.description then
        print("ğŸ“ Beschreibung: " .. itemInfo.description)
    end
end

-- Funktion zum Anzeigen von Items nach Kategorie
local function printItemsByCategory(category)
    if not category then return end
    
    local categoryName = category.name
    local emoji = getCategoryEmoji(categoryName)
    
    print(header(emoji .. " KATEGORIE: " .. categoryName))
    
    local backpackItems = LocalUser.atomMap.player().backpack.items
    local found = false
    local itemsInCategory = {}
    
    -- Items der Kategorie sammeln
    for itemId, itemData in pairs(backpackItems) do
        local itemInfo = ItemsWithId[itemId]
        if itemInfo and itemInfo.category == category then
            found = true
            table.insert(itemsInCategory, {
                id = itemId,
                name = itemInfo.name,
                rarity = itemInfo.rarity,
                quantity = itemData.quantity or 0,
                equipped = itemData.equipped
            })
        end
    end
    
    -- Nach Seltenheit und Namen sortieren
    table.sort(itemsInCategory, function(a, b)
        if a.rarity.value ~= b.rarity.value then
            return a.rarity.value > b.rarity.value -- HÃ¶here Seltenheit zuerst
        end
        return a.name < b.name -- Alphabetisch nach Namen
    end)
    
    if not found then
        print("ğŸ” Keine Items in dieser Kategorie gefunden.")
        return
    end
    
    print("ğŸ” Gefunden: " .. #itemsInCategory .. " Items\n")
    
    -- Items ausgeben
    for _, item in ipairs(itemsInCategory) do
        local rarityEmoji = getRarityEmoji(item.rarity.name)
        local equipped = (item.equipped and "âœ…") or "âŒ"
        
        print(string.format(
            "%s %s (Ã—%d) %s",
            rarityEmoji,
            item.name,
            item.quantity,
            equipped
        ))
    end
end

-- Hauptfunktion zum Ausgeben aller Informationen
local function printAllBackpackInfo()
    printBackpackItems()
    printEquippedItems()
    
    -- Alle Kategorien anzeigen (optional)
    print(header("KATEGORIEÃœBERSICHT"))
    
    -- Alle verfÃ¼gbaren Kategorien durchgehen
    for categoryName, emoji in pairs(CATEGORY_EMOJIS) do
        local category = ItemCategory[categoryName]
        if category then
            local backpackItems = LocalUser.atomMap.player().backpack.items
            local itemCount = 0
            
            -- ZÃ¤hlen, wie viele Items in dieser Kategorie sind
            for itemId, _ in pairs(backpackItems) do
                local itemInfo = ItemsWithId[itemId]
                if itemInfo and itemInfo.category == category then
                    itemCount = itemCount + 1
                end
            end
            
            print(string.format("%s %s: %d Items", emoji, categoryName, itemCount))
        end
    end
end

-- Funktionen ausfÃ¼hren
printAllBackpackInfo()

-- Um detaillierte Infos zu einer bestimmten Kategorie zu erhalten, kommentiere diese Zeile ein:
-- printItemsByCategory(ItemCategory.POTION)

-- Um detaillierte Infos zu einem bestimmten Item zu erhalten, ersetze "item_id_hier" und kommentiere diese Zeile ein:
-- printDetailedItem("item_id_hier")
